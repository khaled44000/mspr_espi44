<!DOCTYPE html>
<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>

	<div style='display: none; position: fixed; top: 10px; width:100%; text-align: center; z-index: 1;'>
		<a href="https://github.com/jeromeetienne/AR.js/" target="_blank">AR.js</a> - example for a-frame
        <br/>
        Contact me any time at <a href='https://twitter.com/jerome_etienne' target='_blank'>@Maehdi49</a>
	</div>
		<a-scene embedded arjs='trackingMethod: best; debugUIEnabled: false; 'id="gltfModel">
		<a-entity light="type: ambient; intensity: 4;"></a-entity>
		<a-marker id="marker-1" type='pattern' url='markers/1.patt'></a-marker>
		<a-marker id="marker-2" type='pattern' url='markers/2.patt'></a-marker>
		<a-marker id="marker-3" type='pattern' url='markers/3.patt'></a-marker>
		<a-marker id="marker-4" type='pattern' url='markers/4.patt'></a-marker>
		<a-camera-static />
	</a-scene>
	
	<script>
		let modelName = "models/simplesnake.gltf"
		
		const scene = document.querySelector('a-scene')
		
		let markersValues = [false, false, false, false]
		
		const markersNodes = document.querySelectorAll('a-marker')
		
		function AreAllMarkersDetected(){
			return markersValues.every(m => m)
		}
		
		function updateMarkerStatus(node, status){
			const [, id] = (node.id || "").match(/^.*(\d+)$/) || [, -1]
			console.log(id, status)
			if(id !== -1 && id <= markersValues.length){
				markersValues[id - 1] = status
			}
			console.log(areAllMarkersDetected())
		}
		
		function loadModel(){
			const loader = new THREE.GLTFLoader();
			loader.load(modelName, model => {
				scene.add(model)
			})
		}
		
		markersNodes.forEach(marker => {
			marker.addEventListener('markerFound', (e) => updateMarkerStatus(e.target, true))
			marker.addEventListener('markerLost', (e) => updateMarkerStatus(e.target, false))
		})
	</script>
</body>
</html>
